
import useBaseUrl from '@docusaurus/useBaseUrl';

作业是作业规范的子结点，它代表了针对某个资产（设备或区域）的现场作业内容。作业可以嵌套作业，也就是说，作业允许有其子作业。作业的执行可以由一系列业务规则来控制。配置好的作业将在手持终端上执行。

## 新建作业

* 在 im **解决方案开发中心**->**作业管理器**内，选中作业作业规范，右键选择**新建作业**，创建一个作业。

  <img alt=" " src={useBaseUrl('docimg/新建作业规范下作业.jpg')} />

* 同时，属性栏出现该作业的属性对话框。

  <img alt=" " src={useBaseUrl('docimg/作业规范下作业通用属性.jpg')} />

## 配置作业通用属性

配置作业通用属性，如图：

<img alt=" " src={useBaseUrl('docimg/作业规范下作业通用属性对话框.jpg')} />

* **作业名** - 作业名称，用于用户对该作业的识别，同一个层次的作业名称是唯一的，不同层次的作业名称可同名。

* **作业描述** - 对该作业的描述信息。

* **启用状态检查** - 是否该作业启用状态检查。状态是针对作业的特殊变量，它是一个列表类型的数据，可以由手持终端的执行者根据现场情况进行录入，录入的数据可以影响作业的执性。最典型的场景比如该作业活动因为某些客观原因影响执行，如关联的设备停电或者无法进入作业现场等，用户在手持终端上录入状态，并根据作业配置的逻辑决定是否执行作业。用户可以决定是否针对该作业启用状态检查。若启用状态检查，应配置一列表数据供手持终端操作时选择，如下图。

  <img alt=" " src={useBaseUrl('docimg/启用状态检查后作业.jpg')} />

  * 启用设备状态，选择需要的列表

    <img alt=" " src={useBaseUrl('docimg/启用状态检查的作业.jpg')} />

    <img alt=" " src={useBaseUrl('docimg/选择列表.jpg')} />

  * 选择相应的列表后会出现**列表约束**，在**列表管理器**中选择解决方案根节点右击， 选择**配置关联关系**

    <img alt=" " src={useBaseUrl('docimg/列表约束的作业.jpg')} />

* **关联资产类别属性** - 可选择一个对应的资产类别属性（关联资产类别内配置）

* **以属性值为默认值** - 以关联的资产类别属性值为该作业规范的默认值。

* **更新资产属性值** - 以作业规范值更新关联的资产类别属性值。

* **默认值** - 该值将在用户使用手持终端执行该作业时出现在值输入框中。可根据需要选择是否使用默认值，不适用则不添加。

* **默认值表达式** - 通过编辑JavaScript脚本表达式的方式计算出默认值，该值将在用户使用手持终端执行该作业时出现在值输入框中。可根据需要选择是否使用默认值表达式，不适用则不添加。

  <img alt=" " src={useBaseUrl('docimg/默认值表达式.jpg')} />

* **重复计算默认值** - 用户使用手持终端执行过一次该作业后，当有相关值发生修改，如果需要重新计算该值时，则可根据需要选择是否使用重复计算默认值，不适用则不勾选。

* **引用名** - 该作业的别名。当其它的作业项逻辑或者作业逻辑的标签变量需要使用该作业状态值时，或作为跳转逻辑行为的目标时，使用该引用名。

* **允许查看历史** - 是否允许手持终端查看该作业状态的历史数据，仅在启用状态检查时有效。

* **允许终端修改** - 是否允许手持终端对作业进行改名、删除等编辑操作。

* **相关业务范畴** - 选择该作业所属业务范畴，可多选。

## 配置作业业务规则

配置作业业务规则，如图：

<img alt=" " src={useBaseUrl('docimg/作业业务规则.jpg')} />

* **可用资产类别** - 配置作业可应用的资产范围

* **可用附件** - 可选择文档、图片等附件以在手持终端上执行该作业时查看，指导作业操作。

* **必须扫描** - 该作业必须扫描，才能对其以及其下所有子作业和作业项进行操作。该项业务规则将影响到其在手持终端上的执行。如果没有扫描，该作业下的所有子作业和作业项均是无效的。只有关联了资产并且该关联资产是扫描点，这个配置才是有效的。

* **顺序执行** - 该作业下的子作业或者作业项要求按照配置的顺序进行执行。在手持终端上， 如果前面的作业未执行，后面的作业或者作业项将是无效的，无法执行。

* **使用上一次的值**- 为方便手持终端用户操作，将该作业规范上一次的值将作为缺省值输入到手持终端。

* **在终端上隐藏** - 该作业在手持终端作业执行页面不可见，在终端导航页面可见。

  * **子节点在视图上为本层** - 该作业子节点上的内容在终端页面上为同层显示。

   <img alt=" " src={useBaseUrl('docimg/终端上隐藏.jpg')} />

* **记录位置标签** - 记录该作业所属位置信息

* **缺省状态** - 系统针对作业有三个状态（该状态不是 **启用状态检查** 中用户自定义的状态，而是启用状态检查的结果）：要求作业，不要求作业，禁止作业。这三个状态可以根据作业逻辑动态变化。

  * **要求作业** - 要求手持终端完成其下的每一个子作业和作业项，如果未完成，绩效统计时将影响完成率计算；

  * **不要求作业** - 不要求的子作业或者作业项，但现场作业人员允许自行根据现场情况进行判断，决定其是否完成。完成的不要求作业项在绩效统计和评估时均作为额外完成作业项处理；

  * **禁止作业** - 在手持终端上无法进行这些作业。

     <img alt=" " src={useBaseUrl('docimg/作业缺省状态.jpg')} />

## 配置作业逻辑

针对作业的三种系统状态：**要求作业**，**不要求作业**和**禁止作业**，允许用户配置作业逻辑来根据现场作业的情况进行动态的赋值。这里的现场作业情况可能是该作业本身的状态检查，也可能来自其它作业状态或作业项的值。

一个作业的逻辑可以有多条，每条逻辑可以由多个条件进行**或**或者**与**的运算组成。每一个逻辑均可以关联例外等级。其具体的配置步骤如下：

* 在**im 解决方案开发中心**->**作业管理器**内，选中作业，右键**配置逻辑**。

  <img alt=" " src={useBaseUrl('docimg/作业配置逻辑.jpg')} />

* 主工作区出现以所选作业名命名的逻辑编辑器选项卡。

  <img alt=" " src={useBaseUrl('docimg/配置逻辑工作区.jpg')} />

* 单击选项卡上方**添加逻辑**按钮，添加一个逻辑。选项卡内出现一个逻辑项目条。针对该逻辑，如果需要的话，用户可以在属性窗口选择关联的例外等级。
 
  <img alt=" " src={useBaseUrl('docimg/作业添加逻辑.jpg')} />

  * **添加逻辑**-针对所选作业，添加逻辑
  * **插入逻辑**-针对所选作业逻辑的位置前，插入逻辑
  * **删除逻辑**-针对所选作业逻辑的位置，删除当前选中的逻辑
  * **全部删除逻辑**-删除本作业下的所有逻辑
  * **添加条件**-针对所选作业逻辑，添加条件
  * **添加脚本条件**-针对所选作业逻辑，添加脚本条件
  * **删除条件**-针对所选作业逻辑条件的位置，删除当前选中条件
  * **上移**-上移选中的逻辑
  * **下移**-下移选中的逻辑

* 在选项卡内选中添加的逻辑，为选中逻辑配置逻辑条件。点击**关系运算**复选框 ，在下拉选单中选择该逻辑内逻辑条件的运算运算关系，如选择**与**运算关系，所有条件均满足才能触发该逻辑；如选择**或**运算关系，任意一个条件将触发该逻辑。 点击**行为**复选框 ，在下拉选单中选择逻辑行为，即当符合该逻辑结果时应进行的逻辑行为。

  <img alt=" " src={useBaseUrl('docimg/作业关系运算.jpg')} />

  <img alt=" " src={useBaseUrl('docimg/作业行为框.jpg')} />

* 在添加的条件项目条上，单击“**标签**”框，在下拉选单中选择一个标签类型。单击“**条件类型**”复选框，在下拉选单中选择一个运算符。单击“**值**”复选框，在下拉选单中选择一个列表项作为条件的值，完成一个条件配置。根据需要继续添加条件。

  <img alt=" " src={useBaseUrl('docimg/作业标签.jpg')} />

  * 标签类型共两种，一为状态，格式“**引用名. @Status**”；一为值，格式“**引用名. @Value**。作业逻辑内仅适用状态标签“**引用名. @Status**”，当引用自身时，所属作业引用名可缺省，即“**@Status**”

    <img alt=" " src={useBaseUrl('docimg/作业条件类型.jpg')} />

  * **=**  等于
  * **< >**  不等于
  * **↗↘>**  连续变化次数大于，该作业项连续作业的多次数值连续变化的次数是否大于某值
  * **↗↘<**  连续变化次数小于，该作业项连续作业的多次数值连续变化的次数是否小于某值
  * **→>**  连续不变次数大于，该作业项连续作业的多次数值连续不变下降的次数是否大于某值
  * **→<**  连续不变次数小于，该作业项连续作业的多次数值连续不变下降的次数是否小于某值

* 重复以上步骤，可添加更多逻辑。
